{% extends 'navbar.html' %} {% block container %}
<div class="header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
  <h1 class="display-4">Physician Portal</h1>
</div>
<div class="container">
  <div class="row">
    <div class="card w-50 mb-2 ml-2 mr-2">
      <div class="card-body">
        <h4 class="card-title">Physician Register</h4>
        <p class="card-text">Register with {{ hospital_name }}.</p>
        <form>
          <div class="form-group">
            <input type="text" class="form-control" id="physician_name" placeholder="Physician Name">
            <input type="text" class="form-control" id="physician_id" placeholder="Physician ID">                
            <a href="#" class="btn btn-primary" role="button" onclick="phys_register()">Register</a>
          </div>
        </form>
        <div class="card-subtitle mb-2 text-muted">Response:</div>
        <div class="card-text" id="registration-output"></div>
      </div>
    </div>
  </div>
  <div class="row">
    <div id="physician_card" class="card w-50 mb-2 ml-2 mr-2" style = "display: none">
      <div class="card-body">
        <h4 class="card-title">Physician Card</h4>
        <div class="card-subtitle mb-2 text-muted">Physician Name: <span class="card-text" id="physician_card_name"></span> </div>
        <div class="card-subtitle mb-2 text-muted">Physician UID: <span class="card-text" id="physician_card_uid"></span> </div>
        <div class="card-subtitle mb-2 text-muted">Hospital Name: <span class="card-text"> {{ hospital_name }} </span></div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="card w-50 mb-2 ml-2 mr-2">
      <div class="card-body">
        <h4 class="card-title">Physician Read</h4>
        <p class="card-text">Obtain patient medical records.</p>
        <form>
          <div class="form-group">
            <input type="text" class="form-control" id="patient_uid" placeholder="Patient UID">
            <a href="#" class="btn btn-primary" role="button" onclick="phys_read()">Read</a>
          </div>
        </form>
        <div class="card-subtitle mb-2 text-muted">Response:</div>
        <div class="card-text" id="read-output"></div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="card w-50 mb-2 ml-2 mr-2">
      <div class="card-body">
        <h4 class="card-title">Physician Write</h4>
        <p class="card-text">Add patient medical record</p>
        <form>
          <div class="form-group">
            <input type="text" class="form-control" id="write_physician_id" placeholder="Physician ID">
            <input type="text" class="form-control" id="write_patient_uid" placeholder="Patient UID">
            <input type="text" class="form-control" id="note" placeholder="Add a note...">                        
            <a href="#" class="btn btn-primary" role="button" onclick="phys_write()">Write</a>
          </div>
        </form>
        <div class="card-subtitle mb-2 text-muted">Response:</div>
        <div class="card-text" id="write-output"></div>
      </div>
    </div>
  </div>
</div>
<script>
  function phys_register() {
    physician_name_div = $('#physician_name');
    let physician_name = physician_name_div.val();
    physician_id_div = $('#physician_id');
    let physician_id = physician_id_div.val();
    data = {name: physician_name, id: physician_id}

    $.ajax({
        url: "http://localhost:{{api_gateway_port}}/physician_reg",
        type: "POST",
        dataType: 'json',
        data: JSON.stringify(data),
        error: function (request, status, error) {
          let reg_div = document.getElementById('registration-output');
          reg_div.innerHTML = "Registration Unsuccessful.";
        },
        success: function (response) {
          console.log(response);
          let reg_div = document.getElementById('registration-output');
          reg_div.innerHTML = "Registration Successful.";
          // Display patient card.
          document.getElementById("physician_card").style.display = "block";
          // Populate patient card.
          let card_physician_name = document.getElementById('physician_card_name');
          card_physician_name.innerHTML = physician_name;
        }
    });
    physician_name_div.val('');
    physician_id_div.val('');
  }

  function phys_read() {
    patient_uid_div = $('#patient_uid');
    let patient_uid = patient_uid_div.val();
    data = {uid: patient_uid}

    $.ajax({
        url: "http://localhost:{{api_gateway_port}}/physician_read",
        type: "POST",
        dataType: 'json',
        data: JSON.stringify(data),
        error: function (request, status, error) {
          console.log('Error: ' + error)
        },
        success: function (response) {
          let read_div = $('#read-output');
          read_div.innerHTML = response;
          alert(response)
        }
    });
    patient_uid_div.val('');
  }

  function phys_write() {
    physician_id_div = $('#write_physician_id');
    let physician_id = physician_id_div.val();
    write_patient_uid_div = $('#write_patient_uid')
    let write_patient_uid = write_patient_uid_div.val();
    note_div = $('#note')
    let note = note_div.val();

    data = {phys_id: physician_id, patient_uid: write_patient_uid, data: note}

    $.ajax({
        url: "http://localhost:{{api_gateway_port}}/physician_write",
        type: "POST",
        dataType: 'json',
        data: JSON.stringify(data),
        error: function (request, status, error) {
          console.log('Error: ' + error)
        },
        success: function (response) {
          let write_div = $('#write-output');
          write_div.innerHTML = response;
          alert(response)
        }
    });
    physician_id_div.val('')
    write_patient_uid_div.val('')
    note_div.val('')
  }
</script>
{% endblock %}
